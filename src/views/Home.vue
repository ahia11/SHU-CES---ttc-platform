<template>
  <div class="home-container">

    <header class="hero-section dynamic">
      <div class="hero-content-dynamic">
        <h1 class="hero-title">æ´å¯Ÿæ•°æ®ï¼Œé©±åŠ¨æœªæ¥ã€‚</h1>
        <p class="hero-subtitle">
          æ‚¨çš„ä¸€ç«™å¼æ™ºèƒ½åˆ†æå¹³å°ï¼šé›†æˆé—¨æ§›æ•ˆåº”ã€ç©ºé—´æº¢å‡ºä¸åŠ¨æ€å› æœã€‚
        </p>
        
        <div class="hero-chart-grid" v-if="heroDataLoaded">
          <div class="hero-chart-cell">
            <div class="chart-label">
              <span>å…¨å›½å…¬è·¯é‡Œç¨‹ (ä¸‡å…¬é‡Œ)</span>
              <span class="chart-value">{{ heroValues.highway.toFixed(2) }}</span>
            </div>
            <v-chart class="spark-chart" :option="highwaySparkOption" autoresize />
          </div>
          <div class="hero-chart-cell">
            <div class="chart-label">
              <span>å…¨å›½é“è·¯è¥ä¸šé‡Œç¨‹ (ä¸‡å…¬é‡Œ)</span>
              <span class="chart-value">{{ heroValues.railway.toFixed(2) }}</span>
            </div>
            <v-chart class="spark-chart" :option="railSparkOption" autoresize />
          </div>
          <div class="hero-chart-cell">
            <div class="chart-label">
              <span>å›½å†…æ¸¸å®¢ (ç™¾ä¸‡äººæ¬¡)</span>
              <span class="chart-value">{{ heroValues.tourism.toFixed(0) }}</span>
            </div>
            <v-chart class="spark-chart" :option="tourismSparkOption" autoresize />
          </div>
          <div class="hero-chart-cell">
            <div class="chart-label">
              <span>å±…æ°‘äººå‡å¯æ”¯é…æ”¶å…¥ (å…ƒ)</span>
              <span class="chart-value">{{ heroValues.income.toFixed(0) }}</span>
            </div>
            <v-chart class="spark-chart" :option="incomeSparkOption" autoresize />
          </div>
        </div>
        
        <div class="hero-cta">
          <router-link to="/explorer" class="cta-button-primary">å¼€å§‹æ¢ç´¢</router-link>
        </div>
      </div>
    </header>

    <section class="features-section">
      <div class="features-grid">
        
        <router-link to="/explorer" class="feature-card-link">
          <div class="feature-card" id="card-explorer">
            <div class="card-icon">ğŸ“Š</div>
            <h3 class="card-title">æ•°æ®æ¢ç´¢</h3>
            <p class="card-description">
              é€šè¿‡ç›´è§‚çš„å›¾è¡¨å’Œäº¤äº’å¼ç­›é€‰ï¼Œæ·±å…¥äº†è§£æ‚¨æ•°æ®çš„åˆ†å¸ƒã€è¶‹åŠ¿å’Œå¼‚å¸¸å€¼ã€‚
            </p>
            <span class="card-link">äº†è§£æ›´å¤š &rarr;</span>
          </div>
        </router-link>
        
        <router-link to="/structure" class="feature-card-link">
          <div class="feature-card" id="card-structure"> <div class="card-icon">ğŸ“ˆ</div> <h3 class="card-title">ç»“æ„å˜è¿åˆ†æ</h3> <p class="card-description">
              ä¸‹é’»åˆ°çœçº§å±‚é¢ï¼Œä¸“æ³¨åˆ†æå„çœäº¤é€šå®¢è¿å†…éƒ¨çš„â€œç»“æ„æ€§å˜æ¢â€ï¼ˆå…¬è·¯ vs é“è·¯ vs æ°´è¿ï¼‰ã€‚
            </p>
            <span class="card-link">äº†è§£æ›´å¤š &rarr;</span>
          </div>
        </router-link>

        <router-link to="/spatial" class="feature-card-link">
          <div class="feature-card" id="card-spatial">
            <div class="card-icon">ğŸ—ºï¸</div>
            <h3 class="card-title">ç©ºé—´æº¢å‡º</h3>
            <p class="card-description">
              é‡åŒ–åˆ†æä¸€ä¸ªåœ°åŒºçš„ç»æµæ´»åŠ¨ï¼ˆå¦‚æ¶ˆè´¹ã€åˆ›æ–°ï¼‰å¦‚ä½•å½±å“å…¶é‚»è¿‘åœ°åŒºã€‚
            </p>
            <span class="card-link">äº†è§£æ›´å¤š &rarr;</span>
          </div>
        </router-link>

        <router-link to="/causal" class="feature-card-link">
          <div class="feature-card" id="card-causal">
            <div class="card-icon">ğŸ”„</div>
            <h3 class="card-title">åŠ¨æ€å› æœ</h3>
            <p class="card-description">
              è¶…è¶Šé™æ€çš„ç›¸å…³æ€§ï¼Œæ­ç¤ºå˜é‡ä¹‹é—´éšæ—¶é—´å˜åŒ–çš„å› æœä¼ å¯¼è·¯å¾„ã€‚
            </p>
            <span class="card-link">äº†è§£æ›´å¤š &rarr;</span>
          </div>
        </router-link>

      </div>
    </section>

    <section class="final-cta-section">
      <h2 class="final-cta-title">å‡†å¤‡å¥½é‡Šæ”¾æ•°æ®çš„å…¨éƒ¨æ½œåŠ›äº†å—ï¼Ÿ</h2>
      <p class="final-cta-subtitle">
        ä»ä»Šå¤©å¼€å§‹ï¼Œå°†å¤æ‚æ•°æ®è½¬åŒ–ä¸ºæ¸…æ™°æ´å¯Ÿã€‚
      </p>
      <div class="hero-cta">
        <router-link to="/explorer" class="cta-button-primary">ç«‹å³å¼€å§‹åˆ†æ</router-link>
      </div>
    </section>

  </div>
</template>

<script setup>
import { RouterLink } from 'vue-router'
import { ref, onMounted, reactive } from 'vue'
import * as echarts from 'echarts'

// ã€HCI æ”¹è¿›ã€‘å›¾è¡¨ Refs
const heroDataLoaded = ref(false)
const highwaySparkOption = ref({})
const railSparkOption = ref({})
const tourismSparkOption = ref({})
const incomeSparkOption = ref({})
const heroValues = reactive({
  highway: 0,
  railway: 0,
  tourism: 0,
  income: 0,
})

// ã€HCI æ”¹è¿›ã€‘åˆ›å»ºå¾®å‹å›¾çš„è¾…åŠ©å‡½æ•°
const createSparkOption = (data, color) => {
  const values = data.map(d => d['æ•°å€¼']).reverse() // ç¡®ä¿æŒ‰æ—¶é—´æ­£åº
  const latestValue = values.length > 0 ? values[values.length - 1] : 0
  
  return {
    grid: { top: 5, bottom: 5, left: 5, right: 5 },
    xAxis: { type: 'category', data: data.map(d => d['å¹´ä»½']).reverse(), show: false },
    yAxis: { type: 'value', show: false, min: 'dataMin', max: 'dataMax' },
    series: [{
      type: 'line',
      data: values,
      smooth: true,
      symbol: 'none',
      lineStyle: { width: 3, color: color },
      areaStyle: {
        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
          { offset: 0, color: color + '80' },
          { offset: 1, color: color + '00' }
        ])
      },
      // å…³é”®ï¼šè¿›å…¥åŠ¨ç”»
      animationEasing: 'cubicInOut',
      animationDuration: 2000,
      animationDelay: 500
    }]
  }
}

// ã€HCI æ”¹è¿›ã€‘åŠ è½½è‹±é›„å›¾è¡¨æ•°æ®
const loadHeroData = async () => {
  try {
    const response = await fetch('/data/yeardatas_converted.json')
    if (!response.ok) throw new Error('yeardatas_converted.json åŠ è½½å¤±è´¥')
    const nationalData = await response.json()

    const highwayData = nationalData['å…¬è·¯é‡Œç¨‹(ä¸‡å…¬é‡Œ)'].filter(d => d.å¹´ä»½ !== '2024')
    const railwayData = nationalData['é“è·¯è¥ä¸šé‡Œç¨‹(ä¸‡å…¬é‡Œ)'].filter(d => d.å¹´ä»½ !== '2024')
    const tourismData = nationalData['å›½å†…æ¸¸å®¢(ç™¾ä¸‡äººæ¬¡)'].filter(d => d.å¹´ä»½ !== '2024')
    const incomeData = nationalData['å±…æ°‘äººå‡å¯æ”¯é…æ”¶å…¥(å…ƒ)'].filter(d => d.å¹´ä»½ !== '2024')

    highwaySparkOption.value = createSparkOption(highwayData, '#38bdf8')
    railSparkOption.value = createSparkOption(railwayData, '#f87171')
    tourismSparkOption.value = createSparkOption(tourismData, '#4ade80')
    incomeSparkOption.value = createSparkOption(incomeData, '#facc15')
    
    heroValues.highway = highwayData[0].æ•°å€¼ // 2023 å¹´æ•°æ®åœ¨æœ€å‰é¢
    heroValues.railway = railwayData[0].æ•°å€¼
    heroValues.tourism = tourismData[0].æ•°å€¼
    heroValues.income = incomeData[0].æ•°å€¼

    heroDataLoaded.value = true
  } catch (error) {
    console.error('è‹±é›„å›¾è¡¨æ•°æ®åŠ è½½å¤±è´¥:', error)
  }
}

onMounted(() => {
  loadHeroData()
})

</script>

<style scoped>
.home-container {
  padding: 0;
  margin: -2rem; /* æŠµæ¶ˆ App.vue çš„ padding */
  text-align: center;
  background-color: #ffffff; /* ç¡®ä¿é¡µé¢åº•è‰²ä¸ºç™½è‰² */
}

/* -----------------
 * 1. Hero Section
 * -----------------
 */
.hero-section {
  padding: 4rem 2rem 4rem; /* è°ƒæ•´å†…è¾¹è· */
  background-image: radial-gradient(at 50% 0%, hsla(210, 60%, 95%, 0.4), transparent 50%);
  border-bottom: 1px solid var(--border-color);
}

.hero-content-dynamic {
  max-width: 1000px; /* æ”¾å¤§å®¹å™¨ä»¥å®¹çº³ç½‘æ ¼ */
  margin: 0 auto;
}

.hero-title {
  font-size: 3.5rem; 
  font-weight: 700;
  letter-spacing: -0.015em;
  margin-bottom: 1rem;
  color: var(--text-color);
}

.hero-subtitle {
  font-size: 1.5rem;
  font-weight: 400;
  color: var(--text-color-light); 
  line-height: 1.5;
  margin: 0 auto 2rem; /* å‡å°‘ä¸ç½‘æ ¼çš„é—´è· */
}

/* ã€HCI æ”¹è¿›ã€‘è‹±é›„å›¾è¡¨ç½‘æ ¼æ ·å¼ */
.hero-chart-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1.5rem;
  margin-bottom: 3rem;
  max-width: 900px;
  margin-left: auto;
  margin-right: auto;
}

.hero-chart-cell {
  background-color: var(--sidebar-bg);
  border-radius: 16px;
  padding: 1.5rem;
  border: 1px solid var(--border-color);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
  text-align: left;
  height: 150px; /* å›ºå®šé«˜åº¦ */
  display: flex;
  flex-direction: column;
}

.chart-label {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  color: var(--text-color);
  font-size: 1rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
}
.chart-value {
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--accent-color);
}
.spark-chart {
  width: 100%;
  flex-grow: 1; /* å æ®å‰©ä½™ç©ºé—´ */
}


.hero-cta {
  display: flex;
  justify-content: center;
  gap: 1rem;
}

/* -----------------
 * CTA æŒ‰é’® (Apple é£æ ¼)
 * -----------------
 */
.cta-button-primary {
  display: inline-block;
  padding: 0.75rem 1.5rem;
  border-radius: 980px; /* èƒ¶å›Šå½¢çŠ¶ */
  text-decoration: none;
  font-size: 1rem;
  font-weight: 500;
  transition: all 0.3s ease;
  background-color: var(--accent-color); 
  color: white;
}
.cta-button-primary:hover {
  background-color: #0071e3;
}

/* -----------------
 * 2. Features Section (æ ·å¼ä¸å˜)
 * -----------------
 */
.features-section {
  padding: 4rem 2rem;
  background-color: #ffffff;
}

.features-grid {
  display: grid;
  grid-template-columns: 1fr; /* ç§»åŠ¨ç«¯å †å  */
  gap: 1.5rem;
  max-width: 1200px;
  margin: 0 auto;
}

/* åœ¨ä¸­ç­‰å±å¹•åŠä»¥ä¸Šï¼Œå˜ä¸º 2x2 ç½‘æ ¼ */
@media (min-width: 768px) {
  .features-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

.feature-card-link {
  text-decoration: none;
  color: inherit;
  display: block;
}

.feature-card {
  background-color: var(--sidebar-bg); /* ä½¿ç”¨æµ…ç°è‰²èƒŒæ™¯ */
  padding: 2.5rem;
  border-radius: 24px; /* æ›´å¤§çš„åœ†è§’ */
  text-align: left;
  height: 100%;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.feature-card-link:hover .feature-card {
  transform: translateY(-5px);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
}

.card-icon {
  font-size: 2.5rem;
  margin-bottom: 1rem;
}

.card-title {
  font-size: 1.75rem;
  font-weight: 600;
  margin-bottom: 0.75rem;
}

.card-description {
  font-size: 1rem;
  color: var(--text-color-light);
  line-height: 1.6;
  margin-bottom: 1.5rem;
}

.card-link {
  font-size: 1rem;
  font-weight: 500;
  color: var(--accent-color);
}

/* -----------------
 * 3. Final CTA Section (æ ·å¼ä¸å˜)
 * -----------------
 */
.final-cta-section {
  padding: 5rem 2rem 6rem;
  background-color: #1d1d1f; /* ä»¿ Apple æ·±è‰² */
  color: #f5f5f7;
}

.final-cta-title {
  font-size: 2.5rem;
  font-weight: 600;
  max-width: 600px;
  margin: 0 auto 1rem;
}

.final-cta-subtitle {
  font-size: 1.25rem;
  font-weight: 400;
  color: rgba(245, 245, 247, 0.8);
  margin: 0 auto 2.5rem;
}

/* å“åº”å¼è°ƒæ•´è‹±é›„ç½‘æ ¼ */
@media (max-width: 768px) {
  .hero-chart-grid {
    grid-template-columns: 1fr;
    height: auto;
  }
  .hero-chart-cell {
    height: 130px; /* ç§»åŠ¨ç«¯ç¨çŸ® */
  }
  .hero-title {
    font-size: 2.5rem;
  }
  .hero-subtitle {
    font-size: 1.2rem;
  }
}
</style>